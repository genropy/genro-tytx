<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: types.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: types.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>/**
 * TYTX Built-in Types
 *
 * Defines the 9 built-in data types for the TYTX protocol.
 *
 * @module types
 */

const { registry } = require('./registry');

/**
 * Decimal library support.
 * Priority: big.js > decimal.js > native Number
 *
 * Install one of these for precise decimal arithmetic:
 *   npm install big.js       # Lightweight (8KB)
 *   npm install decimal.js   # Full-featured (32KB)
 */
let DecimalLib = null;
let decimalLibName = 'number';

// Try big.js first (lighter)
try {
    DecimalLib = require('big.js');
    decimalLibName = 'big.js';
} catch {
    // Try decimal.js as fallback
    try {
        DecimalLib = require('decimal.js');
        decimalLibName = 'decimal.js';
    } catch {
        // No decimal library, will use native Number
    }
}

/**
 * Check if a value is a Decimal instance (Big or Decimal.js)
 */
function isDecimalInstance(value) {
    if (!DecimalLib) return false;
    return value instanceof DecimalLib ||
           (value &amp;&amp; value.constructor &amp;&amp; value.constructor.name === DecimalLib.name);
}

/**
 * Integer type - whole numbers.
 * Genropy: L for long/int
 */
const IntType = {
    name: 'int',
    code: 'L',
    aliases: ['LONG', 'LONGINT', 'I', 'INT', 'INTEGER'],
    js_type: 'number',

    parse(value) {
        return parseInt(value, 10);
    },

    serialize(value) {
        return String(Math.trunc(value));
    },

    format(value, fmt, locale) {
        if (locale) {
            return new Intl.NumberFormat(locale).format(value);
        }
        return String(value);
    }
};

/**
 * Float type - decimal numbers with limited precision.
 * Genropy: R for real/float
 */
const FloatType = {
    name: 'float',
    code: 'R',
    aliases: ['REAL', 'FLOAT', 'F'],
    js_type: 'number',

    parse(value) {
        return parseFloat(value);
    },

    serialize(value) {
        return String(value);
    },

    format(value, fmt, locale) {
        if (locale) {
            return new Intl.NumberFormat(locale, {
                minimumFractionDigits: 2,
                maximumFractionDigits: 2
            }).format(value);
        }
        return value.toFixed(2);
    }
};

/**
 * Boolean type - true/false values.
 */
const BoolType = {
    name: 'bool',
    code: 'B',
    aliases: ['boolean', 'BOOL', 'BOOLEAN'],
    js_type: 'boolean',

    parse(value) {
        const lower = value.toLowerCase();
        return ['true', '1', 'yes', 't', 'on', 'y'].includes(lower);
    },

    serialize(value) {
        return value ? 'true' : 'false';
    }
};

/**
 * String/text type.
 * Genropy: T for text
 */
const StrType = {
    name: 'str',
    code: 'T',
    aliases: ['TEXT', 'P', 'A', 'S', 'STRING'],
    js_type: 'string',

    parse(value) {
        return value;
    },

    serialize(value) {
        return String(value);
    }
};

/**
 * JSON type - serialized object/array structures.
 * Genropy: JS for json
 */
const JsonType = {
    name: 'json',
    code: 'JS',
    aliases: ['JSON', 'J'],
    js_type: 'object',

    parse(value) {
        return JSON.parse(value);
    },

    serialize(value) {
        return JSON.stringify(value);
    }
};

/**
 * Decimal type - exact decimal numbers (for money, etc.).
 * Uses big.js or decimal.js if available, otherwise native Number.
 * Genropy: N for numeric/decimal
 */
const DecimalType = {
    name: 'decimal',
    code: 'N',
    aliases: ['NUMERIC', 'DECIMAL'],
    js_type: DecimalLib ? decimalLibName : 'number',

    parse(value) {
        if (DecimalLib) {
            return new DecimalLib(value);
        }
        return parseFloat(value);
    },

    serialize(value) {
        if (isDecimalInstance(value)) {
            return value.toString();
        }
        return String(value);
    },

    format(value, fmt, locale) {
        // Convert to number for Intl formatting
        const num = isDecimalInstance(value) ? parseFloat(value.toString()) : value;
        if (locale) {
            return new Intl.NumberFormat(locale, {
                minimumFractionDigits: 2,
                maximumFractionDigits: 2
            }).format(num);
        }
        return num.toFixed(2);
    }
};

/**
 * Date type - calendar date without time.
 * Genropy: D for date
 */
const DateType = {
    name: 'date',
    code: 'D',
    aliases: ['DATE'],
    js_type: 'Date',

    parse(value) {
        // Parse ISO date (YYYY-MM-DD)
        const [year, month, day] = value.split('-').map(Number);
        return new Date(year, month - 1, day);
    },

    serialize(value) {
        // Output ISO date (YYYY-MM-DD)
        const year = value.getFullYear();
        const month = String(value.getMonth() + 1).padStart(2, '0');
        const day = String(value.getDate()).padStart(2, '0');
        return `${year}-${month}-${day}`;
    },

    format(value, fmt, locale) {
        if (locale) {
            return new Intl.DateTimeFormat(locale, {
                year: 'numeric',
                month: '2-digit',
                day: '2-digit'
            }).format(value);
        }
        return this.serialize(value);
    }
};

/**
 * DateTime type - date with time.
 * Genropy: DH for datetime
 */
const DateTimeType = {
    name: 'datetime',
    code: 'DH',
    aliases: ['DATETIME', 'DT', 'DHZ', 'timestamp'],
    js_type: 'Date',

    parse(value) {
        // Parse ISO datetime
        return new Date(value);
    },

    serialize(value) {
        // Output ISO datetime
        return value.toISOString();
    },

    format(value, fmt, locale) {
        if (locale) {
            return new Intl.DateTimeFormat(locale, {
                year: 'numeric',
                month: '2-digit',
                day: '2-digit',
                hour: '2-digit',
                minute: '2-digit',
                second: '2-digit'
            }).format(value);
        }
        return this.serialize(value);
    }
};

/**
 * Time type - time without date.
 * Genropy: H for time (hour)
 */
const TimeType = {
    name: 'time',
    code: 'H',
    aliases: ['TIME', 'HZ'],
    js_type: 'string',

    parse(value) {
        // Return time as string (JS has no native time type)
        return value;
    },

    serialize(value) {
        // If Date object, extract time part
        if (value instanceof Date) {
            const hours = String(value.getHours()).padStart(2, '0');
            const minutes = String(value.getMinutes()).padStart(2, '0');
            const seconds = String(value.getSeconds()).padStart(2, '0');
            return `${hours}:${minutes}:${seconds}`;
        }
        return String(value);
    }
};

/**
 * Register all built-in types.
 */
function register_builtins() {
    registry.register(IntType);
    registry.register(FloatType);
    registry.register(BoolType);
    registry.register(StrType);
    registry.register(JsonType);
    registry.register(DecimalType);
    registry.register(DateType);
    registry.register(DateTimeType);
    registry.register(TimeType);
}

// Auto-register on module load
register_builtins();

module.exports = {
    IntType,
    FloatType,
    BoolType,
    StrType,
    JsonType,
    DecimalType,
    DateType,
    DateTimeType,
    TimeType,
    register_builtins,
    // Decimal library info
    DecimalLib,
    decimalLibName,
    isDecimalInstance
};
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Modules</h3><ul><li><a href="module-genro-tytx.html">genro-tytx</a></li><li><a href="module-json_utils.html">json_utils</a></li><li><a href="module-msgpack_utils.html">msgpack_utils</a></li><li><a href="module-registry.html">registry</a></li><li><a href="module-types.html">types</a></li><li><a href="module-tytx_model.html">tytx_model</a></li><li><a href="module-xml_utils.html">xml_utils</a></li></ul><h3>Classes</h3><ul><li><a href="module-tytx_model-TytxModel.html">TytxModel</a></li></ul><h3>Global</h3><ul><li><a href="global.html#dictToXml">dictToXml</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc/jsdoc">JSDoc 4.0.5</a> on Sun Nov 30 2025 12:22:55 GMT+0100 (Central European Standard Time)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
